<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="theme-color" content="#667eea"/>
    <link rel="apple-touch-icon" href="icons/icon-192x192.png">
    <link rel="manifest" href="manifest.json">
    
    <title>Daily Subjects Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .card-shadow { box-shadow: 0 4px 20px rgba(0,0,0,0.1); }
        .task-item { transition: all 0.3s ease; }
        .task-item:hover { transform: translateY(-2px); }
        .print-only { display: none; }
        @media print {
            .no-print { display: none !important; }
            .print-only { display: block !important; }
            body { background: white !important; }
            .bg-blue-100, .bg-green-100, .bg-purple-100, .bg-pink-100, 
            .bg-yellow-100, .bg-indigo-100, .bg-red-100, .bg-teal-100 { 
                background: white !important; 
                border: 1px solid #ccc !important; 
            }
            .card-shadow { box-shadow: none !important; border: 1px solid #ddd !important; }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <div class="gradient-bg text-white p-3 no-print">
        <div class="max-w-4xl mx-auto flex justify-between items-center">
            <div>
                <h1 class="text-lg font-bold mb-1">üìö Daily Subjects</h1>
                <p class="text-blue-100 text-xs" id="currentDate"></p>
            </div>
            <div class="flex gap-2">
                <button onclick="openAddSubjectModal()" 
                        class="bg-white bg-opacity-20 hover:bg-opacity-30 p-2 rounded-full transition-all duration-300 hover:scale-110">
                    <span class="text-sm">‚ûï</span>
                </button>
                <button onclick="openHistoryModal()" 
                        class="bg-white bg-opacity-20 hover:bg-opacity-30 p-2 rounded-full transition-all duration-300 hover:scale-110">
                    <span class="text-sm">üìÖ</span>
                </button>
            </div>
        </div>
    </div>

    <div class="max-w-4xl mx-auto p-6">


        <div id="subjectsContainer" class="space-y-4">
            </div>

        <div class="print-only">
            <div class="text-center mb-8">
                <h1 class="text-3xl font-bold text-gray-800 mb-2">üìö Daily Subjects Report</h1>
                <p class="text-lg text-gray-600" id="printDate"></p>
            </div>
        </div>
    </div>

    <div id="addSubjectModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 no-print">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-xl max-w-md w-full p-6 transform transition-all">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-800">üìù ‡§®‡§Ø‡§æ ‡§µ‡§ø‡§∑‡§Ø ‡§ú‡•ã‡§°‡§º‡•á‡§Ç</h2>
                    <button onclick="closeAddSubjectModal()" class="text-gray-500 hover:text-gray-700 text-2xl">‚úï</button>
                </div>
                
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">‡§µ‡§ø‡§∑‡§Ø ‡§ï‡§æ ‡§®‡§æ‡§Æ</label>
                        <input type="text" id="modalSubjectName" placeholder="‡§ú‡•à‡§∏‡•á: ‡§ó‡§£‡§ø‡§§, ‡§µ‡§ø‡§ú‡•ç‡§û‡§æ‡§®..." 
                               class="w-full px-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                               onkeypress="if(event.key==='Enter') addSubjectFromModal()">
                    </div>
                    
                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡§∂‡•Å‡§∞‡•Å‡§Ü‡§§ ‡§ï‡§æ ‡§∏‡§Æ‡§Ø</label>
                            <input type="time" id="modalSubjectStartTime" 
                                   class="w-full px-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                   onkeypress="if(event.key==='Enter') addSubjectFromModal()">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡§Ö‡§Ç‡§§ ‡§ï‡§æ ‡§∏‡§Æ‡§Ø</label>
                            <input type="time" id="modalSubjectEndTime" 
                                   class="w-full px-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                   onkeypress="if(event.key==='Enter') addSubjectFromModal()">
                        </div>
                    </div>
                    
                    <div class="flex gap-3 pt-4">
                        <button onclick="addSubjectFromModal()" 
                                class="flex-1 bg-blue-600 hover:bg-blue-700 text-white py-3 rounded-lg font-medium transition-colors">
                            ‚ûï ‡§ú‡•ã‡§°‡§º‡•á‡§Ç
                        </button>
                        <button onclick="closeAddSubjectModal()" 
                                class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-700 py-3 rounded-lg font-medium transition-colors">
                            ‡§∞‡§¶‡•ç‡§¶ ‡§ï‡§∞‡•á‡§Ç
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="historyModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 no-print">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-xl max-w-lg w-full p-6 transform transition-all max-h-96 overflow-y-auto">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-800">üìÖ History</h2>
                    <button onclick="closeHistoryModal()" class="text-gray-500 hover:text-gray-700 text-2xl">‚úï</button>
                </div>
                
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">‡§¶‡§ø‡§®‡§æ‡§Ç‡§ï ‡§ö‡•Å‡§®‡•á‡§Ç</label>
                        <select id="modalHistoryDate" onchange="loadHistoryFromModal()" 
                                class="w-full px-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500">
                            <option value="">‡§Ü‡§ú ‡§ï‡§æ ‡§¶‡§ø‡§®</option>
                        </select>
                    </div>
                    
                    <div id="historyPreview" class="bg-gray-50 rounded-lg p-4 min-h-32">
                        <p class="text-gray-500 text-center">‡§¶‡§ø‡§®‡§æ‡§Ç‡§ï ‡§ö‡•Å‡§®‡•á‡§Ç ‡§Ø‡§æ ‡§Ü‡§ú ‡§ï‡§æ ‡§°‡•á‡§ü‡§æ ‡§¶‡•á‡§ñ‡•á‡§Ç</p>
                    </div>
                    
                    <div class="flex gap-3 pt-4">
                        <button onclick="printHistoryFromModal()" 
                                class="flex-1 bg-green-600 hover:bg-green-700 text-white py-3 rounded-lg font-medium transition-colors">
                            üñ®Ô∏è Print ‡§ï‡§∞‡•á‡§Ç
                        </button>
                        <button onclick="loadSelectedHistory()" 
                                class="flex-1 bg-blue-600 hover:bg-blue-700 text-white py-3 rounded-lg font-medium transition-colors">
                            üìã Load ‡§ï‡§∞‡•á‡§Ç
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ‡§Ü‡§™‡§ï‡§æ ‡§∏‡§æ‡§∞‡§æ ‡§Æ‡•å‡§ú‡•Ç‡§¶‡§æ ‡§ú‡§æ‡§µ‡§æ‡§∏‡•ç‡§ï‡•ç‡§∞‡§ø‡§™‡•ç‡§ü ‡§ï‡•ã‡§° ‡§Ø‡§π‡§æ‡§Å ‡§∞‡§π‡•á‡§ó‡§æ...
        let subjects = [];
        let history = {};
        let currentHistoryDate = null;

        // Initialize app
        function init() {
            loadData();
            updateCurrentDate();
            loadHistoryDates();
            renderSubjects();
            setInterval(sortSubjectsByTime, 60000); // Sort every minute
        }

        // Update current date display
        function updateCurrentDate() {
            const now = new Date();
            const options = { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            };
            document.getElementById('currentDate').textContent = now.toLocaleDateString('hi-IN', options);
        }

        // Modal functions
        function openAddSubjectModal() {
            document.getElementById('addSubjectModal').classList.remove('hidden');
            document.getElementById('modalSubjectName').focus();
        }

        function closeAddSubjectModal() {
            document.getElementById('addSubjectModal').classList.add('hidden');
            document.getElementById('modalSubjectName').value = '';
            document.getElementById('modalSubjectStartTime').value = '';
            document.getElementById('modalSubjectEndTime').value = '';
        }

        function openHistoryModal() {
            document.getElementById('historyModal').classList.remove('hidden');
            loadHistoryDatesInModal();
            showHistoryPreview();
        }

        function closeHistoryModal() {
            document.getElementById('historyModal').classList.add('hidden');
        }

        // Add new subject from modal
        function addSubjectFromModal() {
            const name = document.getElementById('modalSubjectName').value.trim();
            const startTime = document.getElementById('modalSubjectStartTime').value;
            const endTime = document.getElementById('modalSubjectEndTime').value;
            
            if (!name) {
                alert('‡§ï‡•É‡§™‡§Ø‡§æ ‡§µ‡§ø‡§∑‡§Ø ‡§ï‡§æ ‡§®‡§æ‡§Æ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç');
                return;
            }
            
            if (!startTime || !endTime) {
                alert('‡§ï‡•É‡§™‡§Ø‡§æ ‡§∂‡•Å‡§∞‡•Å‡§Ü‡§§ ‡§î‡§∞ ‡§Ö‡§Ç‡§§ ‡§ï‡§æ ‡§∏‡§Æ‡§Ø ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç');
                return;
            }
            
            if (startTime >= endTime) {
                alert('‡§Ö‡§Ç‡§§ ‡§ï‡§æ ‡§∏‡§Æ‡§Ø ‡§∂‡•Å‡§∞‡•Å‡§Ü‡§§ ‡§ï‡•á ‡§∏‡§Æ‡§Ø ‡§∏‡•á ‡§¨‡§æ‡§¶ ‡§π‡•ã‡§®‡§æ ‡§ö‡§æ‡§π‡§ø‡§è');
                return;
            }
            
            // Check for time overlap
            const hasOverlap = subjects.some(subject => {
                return timeRangesOverlap(startTime, endTime, subject.startTime, subject.endTime);
            });
            
            if (hasOverlap) {
                alert('‡§á‡§∏ ‡§∏‡§Æ‡§Ø ‡§Æ‡•á‡§Ç ‡§™‡§π‡§≤‡•á ‡§∏‡•á ‡§ï‡•ã‡§à ‡§µ‡§ø‡§∑‡§Ø ‡§π‡•à‡•§ ‡§ï‡•É‡§™‡§Ø‡§æ ‡§Ö‡§≤‡§ó ‡§∏‡§Æ‡§Ø ‡§ö‡•Å‡§®‡•á‡§Ç‡•§');
                return;
            }

            const subject = {
                id: Date.now(),
                name: name,
                startTime: startTime,
                endTime: endTime,
                tasks: [],
                color: getRandomColor(),
                expanded: false
            };

            subjects.push(subject);
            closeAddSubjectModal();
            saveData();
            renderSubjects();
        }
        
        // Check if two time ranges overlap
        function timeRangesOverlap(start1, end1, start2, end2) {
            return start1 < end2 && start2 < end1;
        }

        // Legacy function for backward compatibility
        function addSubject() {
            addSubjectFromModal();
        }

        // Get random color for subject cards
        function getRandomColor() {
            const colors = [
                'bg-blue-100 border-blue-300',
                'bg-green-100 border-green-300',
                'bg-purple-100 border-purple-300',
                'bg-pink-100 border-pink-300',
                'bg-yellow-100 border-yellow-300',
                'bg-indigo-100 border-indigo-300',
                'bg-red-100 border-red-300',
                'bg-teal-100 border-teal-300'
            ];
            return colors[Math.floor(Math.random() * colors.length)];
        }

        // Add task to subject
        function addTask(subjectId) {
            const input = document.getElementById(`taskInput-${subjectId}`);
            const taskText = input.value.trim();
            
            if (!taskText) return;

            const subject = subjects.find(s => s.id === subjectId);
            if (subject) {
                subject.tasks.push({
                    id: Date.now(),
                    text: taskText,
                    completed: false
                });
                input.value = '';
                hideTaskInput(subjectId);
                saveData();
                renderSubjects();
            }
        }

        // Toggle task completion
        function toggleTask(subjectId, taskId) {
            const subject = subjects.find(s => s.id === subjectId);
            if (subject) {
                const task = subject.tasks.find(t => t.id === taskId);
                if (task) {
                    task.completed = !task.completed;
                    saveData();
                    renderSubjects();
                }
            }
        }
        
        // Toggle all tasks in a subject
        function toggleAllTasks(subjectId) {
            const subject = subjects.find(s => s.id === subjectId);
            if (subject && subject.tasks.length > 0) {
                const allCompleted = subject.tasks.every(task => task.completed);
                subject.tasks.forEach(task => {
                    task.completed = !allCompleted;
                });
                saveData();
                renderSubjects();
            }
        }

        // Delete task
        function deleteTask(subjectId, taskId) {
            const subject = subjects.find(s => s.id === subjectId);
            if (subject) {
                subject.tasks = subject.tasks.filter(t => t.id !== taskId);
                saveData();
                renderSubjects();
            }
        }

        // Delete subject
        function deleteSubject(subjectId) {
            if (confirm('‡§ï‡•ç‡§Ø‡§æ ‡§Ü‡§™ ‡§á‡§∏ ‡§µ‡§ø‡§∑‡§Ø ‡§ï‡•ã ‡§π‡§ü‡§æ‡§®‡§æ ‡§ö‡§æ‡§π‡§§‡•á ‡§π‡•à‡§Ç?')) {
                subjects = subjects.filter(s => s.id !== subjectId);
                saveData();
                renderSubjects();
            }
        }

        // Toggle subject expansion
        function toggleSubject(subjectId) {
            const subject = subjects.find(s => s.id === subjectId);
            if (subject) {
                // Close all other subjects
                subjects.forEach(s => {
                    if (s.id !== subjectId) {
                        s.expanded = false;
                    }
                });
                // Toggle current subject
                subject.expanded = !subject.expanded;
                saveData();
                renderSubjects();
            }
        }
        
        // Show task input
        function showTaskInput(subjectId) {
            const container = document.getElementById(`taskInputContainer-${subjectId}`);
            const input = document.getElementById(`taskInput-${subjectId}`);
            if (container && input) {
                container.classList.remove('hidden');
                input.focus();
            }
        }
        
        // Hide task input
        function hideTaskInput(subjectId) {
            const container = document.getElementById(`taskInputContainer-${subjectId}`);
            const input = document.getElementById(`taskInput-${subjectId}`);
            if (container && input) {
                container.classList.add('hidden');
                input.value = '';
            }
        }

        // Sort subjects by time
        function sortSubjectsByTime() {
            const now = new Date();
            const currentTime = now.getHours() * 60 + now.getMinutes();
            
            subjects.sort((a, b) => {
                const timeA = a.startTime ? parseInt(a.startTime.split(':')[0]) * 60 + parseInt(a.startTime.split(':')[1]) : 540;
                const timeB = b.startTime ? parseInt(b.startTime.split(':')[0]) * 60 + parseInt(b.startTime.split(':')[1]) : 540;
                
                // Current or upcoming subjects first
                const diffA = timeA >= currentTime ? timeA - currentTime : timeA + 1440 - currentTime;
                const diffB = timeB >= currentTime ? timeB - currentTime : timeB + 1440 - currentTime;
                
                return diffA - diffB;
            });
            
            renderSubjects();
        }

        // Render all subjects
        function renderSubjects() {
            const container = document.getElementById('subjectsContainer');
            
            if (subjects.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-12 text-gray-500">
                        <div class="text-6xl mb-4">üìö</div>
                        <p class="text-lg">‡§Ö‡§≠‡•Ä ‡§§‡§ï ‡§ï‡•ã‡§à ‡§µ‡§ø‡§∑‡§Ø ‡§®‡§π‡•Ä‡§Ç ‡§ú‡•ã‡§°‡§º‡§æ ‡§ó‡§Ø‡§æ ‡§π‡•à</p>
                        <p class="text-sm">‡§ä‡§™‡§∞ ‡§∏‡•á ‡§®‡§Ø‡§æ ‡§µ‡§ø‡§∑‡§Ø ‡§ú‡•ã‡§°‡§º‡•á‡§Ç</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = subjects.map(subject => `
                <div class="bg-white rounded-xl card-shadow ${subject.color} border-2 overflow-hidden">
                    <div class="p-4 cursor-pointer hover:bg-opacity-80 transition-all ${subject.tasks.length > 0 && subject.tasks.every(t => t.completed) ? 'bg-green-50 border-green-400' : ''}" onclick="toggleSubject(${subject.id})">
                        <div class="flex justify-between items-center">
                            <div class="flex items-center gap-3">
                                <h3 class="text-lg font-semibold text-gray-800">${subject.name}</h3>
                                <span class="bg-white px-2 py-1 rounded-full text-xs font-medium text-gray-600">
                                    üïê ${subject.startTime} - ${subject.endTime}
                                </span>
                            </div>
                            <div class="flex items-center gap-2">
                                ${subject.tasks.length > 0 ? `
                                    <button onclick="toggleAllTasks(${subject.id}); event.stopPropagation();" 
                                            class="w-6 h-6 rounded border-2 flex items-center justify-center transition-all hover:scale-110 ${subject.tasks.every(t => t.completed) ? 'bg-green-500 border-green-500 text-white' : 'border-gray-300 hover:border-green-400'}">
                                        ${subject.tasks.every(t => t.completed) ? '‚úì' : ''}
                                    </button>
                                ` : ''}
                                <span class="transform transition-transform ${subject.expanded ? 'rotate-180' : ''} text-gray-400">‚ñº</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="${subject.expanded ? 'block' : 'hidden'} border-t border-gray-200">
                        <div class="p-4">
                            <div class="mb-4 no-print">
                                <button onclick="showTaskInput(${subject.id}); event.stopPropagation();" 
                                        class="w-full bg-blue-50 hover:bg-blue-100 text-blue-600 py-2 px-4 rounded-lg transition-colors text-sm font-medium border border-blue-200">
                                    ‚ûï ‡§®‡§Ø‡§æ ‡§ï‡§æ‡§∞‡•ç‡§Ø ‡§ú‡•ã‡§°‡§º‡•á‡§Ç
                                </button>
                            </div>
                            
                            <div id="taskInputContainer-${subject.id}" class="hidden mb-4 no-print">
                                <div class="flex gap-2">
                                    <input type="text" id="taskInput-${subject.id}" 
                                           placeholder="‡§ï‡§æ‡§∞‡•ç‡§Ø ‡§ï‡§æ ‡§®‡§æ‡§Æ..." 
                                           class="flex-1 px-3 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"
                                           onkeypress="if(event.key==='Enter') addTask(${subject.id})"
                                           onclick="event.stopPropagation()">
                                    <button onclick="addTask(${subject.id}); event.stopPropagation();" 
                                            class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-2 rounded-lg transition-colors text-sm">
                                        ‚úì
                                    </button>
                                    <button onclick="hideTaskInput(${subject.id}); event.stopPropagation();" 
                                            class="bg-gray-300 hover:bg-gray-400 text-gray-700 px-3 py-2 rounded-lg transition-colors text-sm">
                                        ‚úï
                                    </button>
                                </div>
                            </div>
                            
                            <div class="space-y-2">
                                ${subject.tasks.map(task => `
                                    <div class="task-item flex items-center gap-3 p-2 bg-gray-50 rounded-lg border ${task.completed ? 'opacity-60' : ''}" onclick="event.stopPropagation()">
                                        <input type="checkbox" ${task.completed ? 'checked' : ''} 
                                               onchange="toggleTask(${subject.id}, ${task.id})"
                                               class="w-4 h-4 text-blue-600 rounded focus:ring-blue-500">
                                        <span class="flex-1 text-sm ${task.completed ? 'line-through text-gray-500' : 'text-gray-800'}">${task.text}</span>
                                        <button onclick="deleteTask(${subject.id}, ${task.id})" 
                                                class="text-red-500 hover:text-red-700 text-xs no-print">
                                            üóëÔ∏è
                                        </button>
                                    </div>
                                `).join('')}
                                
                                ${subject.tasks.length === 0 ? `
                                    <div class="text-center py-3 text-gray-400">
                                        <p class="text-sm">‡§Ö‡§≠‡•Ä ‡§§‡§ï ‡§ï‡•ã‡§à ‡§ï‡§æ‡§∞‡•ç‡§Ø ‡§®‡§π‡•Ä‡§Ç ‡§ú‡•ã‡§°‡§º‡§æ ‡§ó‡§Ø‡§æ</p>
                                    </div>
                                ` : ''}
                            </div>
                            
                            <div class="mt-4 pt-3 border-t border-gray-200 no-print">
                                <button onclick="deleteSubject(${subject.id}); event.stopPropagation();" 
                                        class="w-full bg-red-50 hover:bg-red-100 text-red-600 py-2 px-4 rounded-lg transition-colors text-sm font-medium border border-red-200">
                                    üóëÔ∏è ‡§µ‡§ø‡§∑‡§Ø ‡§π‡§ü‡§æ‡§è‡§Ç
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Save data to localStorage
        function saveData() {
            const today = new Date().toDateString();
            
            // Save current subjects
            localStorage.setItem('dailySubjects', JSON.stringify(subjects));
            
            // Save to history
            if (!history[today]) {
                history[today] = [];
            }
            history[today] = JSON.parse(JSON.stringify(subjects));
            localStorage.setItem('subjectsHistory', JSON.stringify(history));
            
            loadHistoryDates();
        }

        // Load data from localStorage
        function loadData() {
            const savedSubjects = localStorage.getItem('dailySubjects');
            const savedHistory = localStorage.getItem('subjectsHistory');
            
            if (savedSubjects) {
                subjects = JSON.parse(savedSubjects);
            }
            
            if (savedHistory) {
                history = JSON.parse(savedHistory);
            }
        }

        // Load history dates in modal
        function loadHistoryDatesInModal() {
            const select = document.getElementById('modalHistoryDate');
            // Clear existing options except first one
            while (select.children.length > 1) {
                select.removeChild(select.lastChild);
            }
            
            Object.keys(history).forEach(date => {
                const option = document.createElement('option');
                option.value = date;
                option.textContent = new Date(date).toLocaleDateString('hi-IN');
                select.appendChild(option);
            });
        }

        // Show history preview in modal
        function showHistoryPreview() {
            const selectedDate = document.getElementById('modalHistoryDate').value;
            const dataToShow = selectedDate ? (history[selectedDate] || []) : subjects;
            const preview = document.getElementById('historyPreview');
            
            if (dataToShow.length === 0) {
                preview.innerHTML = '<p class="text-gray-500 text-center">‡§á‡§∏ ‡§¶‡§ø‡§® ‡§ï‡•ã‡§à ‡§°‡•á‡§ü‡§æ ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ</p>';
                return;
            }
            
            const totalTasks = dataToShow.reduce((sum, subject) => sum + subject.tasks.length, 0);
            const completedTasks = dataToShow.reduce((sum, subject) => 
                sum + subject.tasks.filter(task => task.completed).length, 0);
            
            preview.innerHTML = `
                <div class="space-y-2">
                    <div class="flex justify-between text-sm">
                        <span class="font-medium">‡§ï‡•Å‡§≤ ‡§µ‡§ø‡§∑‡§Ø:</span>
                        <span>${dataToShow.length}</span>
                    </div>
                    <div class="flex justify-between text-sm">
                        <span class="font-medium">‡§ï‡•Å‡§≤ ‡§ï‡§æ‡§∞‡•ç‡§Ø:</span>
                        <span>${totalTasks}</span>
                    </div>
                    <div class="flex justify-between text-sm">
                        <span class="font-medium">‡§™‡•Ç‡§∞‡•ç‡§£ ‡§ï‡§æ‡§∞‡•ç‡§Ø:</span>
                        <span class="text-green-600">${completedTasks}</span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-2 mt-3">
                        <div class="bg-green-500 h-2 rounded-full" 
                             style="width: ${totalTasks ? (completedTasks / totalTasks) * 100 : 0}%"></div>
                    </div>
                    <div class="text-xs text-gray-500 mt-2">
                        ${dataToShow.map(s => s.name).join(', ')}
                    </div>
                </div>
            `;
        }

        // Load history from modal
        function loadHistoryFromModal() {
            showHistoryPreview();
        }

        // Load selected history and close modal
        function loadSelectedHistory() {
            const selectedDate = document.getElementById('modalHistoryDate').value;
            
            if (!selectedDate) {
                // Load today's data
                loadData();
                currentHistoryDate = null;
                renderSubjects();
            } else {
                // Load historical data
                currentHistoryDate = selectedDate;
                subjects = history[selectedDate] || [];
                renderSubjects();
            }
            
            closeHistoryModal();
        }

        // Print history from modal
        function printHistoryFromModal() {
            const selectedDate = document.getElementById('modalHistoryDate').value;
            const dateToShow = selectedDate || new Date().toDateString();
            const dataToShow = selectedDate ? (history[selectedDate] || []) : subjects;
            
            document.getElementById('printDate').textContent = new Date(dateToShow).toLocaleDateString('hi-IN', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            
            // Temporarily show print data
            const originalSubjects = [...subjects];
            subjects = dataToShow;
            renderSubjects();
            
            // Close modal and print
            closeHistoryModal();
            window.print();
            
            // Restore original data
            subjects = originalSubjects;
            renderSubjects();
        }

        // Legacy functions for backward compatibility
        function loadHistoryDates() {
            loadHistoryDatesInModal();
        }

        function loadHistoryDate() {
            loadSelectedHistory();
        }

        // Print history
        function printHistory() {
            const selectedDate = document.getElementById('historyDate').value;
            const dateToShow = selectedDate || new Date().toDateString();
            const dataToShow = selectedDate ? (history[selectedDate] || []) : subjects;
            
            document.getElementById('printDate').textContent = new Date(dateToShow).toLocaleDateString('hi-IN', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            
            // Temporarily show print data
            const originalSubjects = [...subjects];
            subjects = dataToShow;
            renderSubjects();
            
            // Print
            window.print();
            
            // Restore original data
            subjects = originalSubjects;
            renderSubjects();
        }

        // Initialize app when page loads
        init();
    </script>
    
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => {
                        console.log('ServiceWorker registration successful with scope: ', registration.scope);
                    })
                    .catch(err => {
                        console.log('ServiceWorker registration failed: ', err);
                    });
            });
        }
    </script>
</body>
</html>
